.span12
  %h1
    Forums
    - if can? :manage, "Administration"
      =link_to "New forum", new_forum_path, :class => "btn btn-mini btn-success pull-right"
      
.span12.forums
  - for forum in @forums
    .forum
      .action-group
        - if user_signed_in?
          = link_to "Start new topic", new_forum_topic_path(forum.slug), :class => "btn btn-mini btn-success"
        - if can? :manage, "Administration"
          = link_to "Edit", edit_forum_path(forum.slug), :class => "btn btn-mini"
          = link_to "Delete", forum_path(forum.slug), :method => :delete, :confirm => "Are You sure to delete #{forum.title}?", :class => "btn btn-mini btn-danger"

      %h3
        = link_to forum_path(forum.slug) do
          = forum.title
          %small
            = "(#{forum.topics.count}"
            topics)
        %small
          &bull;
          = forum.description
          &bull;
          %strong= "Last activity #{distance_of_time_in_words_to_now(forum.topics.maximum("updated_at"))} ago" if forum.topics.maximum("updated_at")
    .row-fluid.topics
      - if forum == @forum
        - for topic in @forum.topics
          .span12.topic
            .action-group
              - if can? :manage, topic
                = link_to "Edit", edit_forum_topic_path(forum.slug,topic.slug), :class => "btn btn-mini"
              - if can? :manage, "Administration"
                = link_to "Delete", forum_topic_path(forum.slug,topic.slug), :method => :delete, :confirm => "Are You sure to delete #{topic.title}?", :class => "btn btn-mini btn-danger"
            %h4
              = link_to "#{topic.title} ( #{topic.comments.count} comments )", forum_topic_path(forum.slug, topic.slug)
            %small= "Started by #{topic.user.display_name} #{distance_of_time_in_words_to_now(topic.created_at)} ago."
            %small
              %strong= "Last activity #{distance_of_time_in_words_to_now(topic.updated_at)} ago"
